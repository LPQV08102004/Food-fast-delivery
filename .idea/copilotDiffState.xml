<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/FIX_CORS_ERROR_GUIDE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/FIX_CORS_ERROR_GUIDE.md" />
              <option name="updatedContent" value="#  HƯỚNG DẪN SỬA LỖI CORS - &quot;Multiple values not allowed&quot;&#10;&#10;## ❌ VẤN ĐỀ&#10;Postman hoạt động bình thường nhưng browser báo lỗi CORS:&#10;```&#10;Access-Control-Allow-Origin header contains multiple values 'http://localhost:3000, *', but only one is allowed&#10;```&#10;&#10;##  NGUYÊN NHÂN&#10;- **User Service** có `@CrossOrigin(origins = &quot;*&quot;)` → gửi header: `Access-Control-Allow-Origin: *`&#10;- **API Gateway** cũng có CORS config → gửi header: `Access-Control-Allow-Origin: http://localhost:3000`&#10;- Browser nhận được **2 headers trùng lặp** → BỊ CHẶN!&#10;- Postman không kiểm tra CORS → hoạt động bình thường&#10;&#10;## ✅ GIẢI PHÁP ĐÃ THỰC HIỆN&#10;&#10;### 1. Xóa `@CrossOrigin` khỏi UserController&#10;File: `user-service/src/main/java/vn/cnpm/user_service/Controller/UserController.java`&#10;- ✅ Đã xóa annotation `@CrossOrigin(origins = &quot;*&quot;)` &#10;- Lý do: API Gateway sẽ xử lý CORS thay vì backend&#10;&#10;### 2. Cấu hình API Gateway với DedupeResponseHeader&#10;File: `api-gateway/src/main/resources/application.yml`&#10;- ✅ Đã thêm filter `DedupeResponseHeader` vào tất cả routes&#10;- Filter này sẽ loại bỏ CORS headers trùng lặp nếu vẫn còn&#10;&#10;##  CÁC BƯỚC KHẮC PHỤC NGAY&#10;&#10;### Bước 1: Restart User Service&#10;User Service cần restart để áp dụng thay đổi (đã xóa @CrossOrigin):&#10;&#10;```cmd&#10;# Vào terminal đang chạy User Service, nhấn Ctrl+C để dừng&#10;# Sau đó chạy lại:&#10;cd C:\Study\CNPM\Food-fast-delivery\user-service&#10;mvnw spring-boot:run&#10;```&#10;&#10;Đợi đến khi thấy log: `Tomcat started on port(s): 8081`&#10;&#10;### Bước 2: Kiểm tra API Gateway đã chạy chưa&#10;```cmd&#10;# Nếu chưa chạy, khởi động:&#10;cd C:\Study\CNPM\Food-fast-delivery\api-gateway&#10;gradlew bootRun&#10;```&#10;&#10;Đợi đến khi thấy: `Netty started on port 8080`&#10;&#10;### Bước 3: Kiểm tra Eureka Dashboard&#10;Mở browser và vào: http://localhost:8761&#10;&#10;Đảm bảo thấy:&#10;- ✅ **API-GATEWAY** - Status: UP&#10;- ✅ **USER-SERVICE** - Status: UP&#10;&#10;Nếu không thấy → services chưa đăng ký được với Eureka.&#10;&#10;### Bước 4: Test API qua Gateway bằng Postman&#10;&#10;```bash&#10;# Test 1: Get all users (cần token)&#10;GET http://localhost:8080/api/users&#10;Headers:&#10;  Authorization: Bearer YOUR_TOKEN_HERE&#10;```&#10;&#10;Kiểm tra Response Headers trong Postman:&#10;- ✅ Chỉ có **1 header** `Access-Control-Allow-Origin: http://localhost:3000`&#10;- ❌ Không được có 2 headers trùng lặp&#10;&#10;### Bước 5: Clear Browser Cache và Restart Frontend&#10;&#10;```cmd&#10;# 1. Dừng frontend (Ctrl+C)&#10;# 2. Clear cache&#10;# 3. Restart:&#10;cd C:\Study\CNPM\Food-fast-delivery\Front_end\foodfast-app&#10;npm start&#10;```&#10;&#10;Trong browser:&#10;1. Nhấn `Ctrl+Shift+Delete`&#10;2. Chọn: &quot;Cached images and files&quot; + &quot;Cookies and other site data&quot;&#10;3. Click &quot;Clear data&quot;&#10;4. Đóng browser và mở lại&#10;&#10;### Bước 6: Test trong Admin Dashboard&#10;&#10;1. Vào: http://localhost:3000/login&#10;2. Login với admin&#10;3. Vào Admin Dashboard → Click tab &quot;User&quot;&#10;4. Mở DevTools (F12) → Tab Network&#10;5. Xem request tới `/api/users`:&#10;   - ✅ Status: 200 OK&#10;   - ✅ Không có lỗi CORS trong Console&#10;&#10;##  KẾT QUẢ MONG ĐỢI&#10;&#10;### TRƯỚC (Lỗi):&#10;```&#10;Response Headers:&#10;Access-Control-Allow-Origin: *&#10;Access-Control-Allow-Origin: http://localhost:3000&#10;❌ Browser: Error! Multiple values not allowed!&#10;```&#10;&#10;### SAU (Đúng):&#10;```&#10;Response Headers:&#10;Access-Control-Allow-Origin: http://localhost:3000&#10;Access-Control-Allow-Credentials: true&#10;✅ Browser: Request successful!&#10;```&#10;&#10;##  TROUBLESHOOTING&#10;&#10;### Vẫn còn lỗi CORS?&#10;&#10;**1. Kiểm tra User Service đã restart chưa:**&#10;```bash&#10;# Check log của User Service, phải thấy:&#10;Started UserServiceApplication in X seconds&#10;```&#10;&#10;**2. Kiểm tra Response Headers bằng Postman:**&#10;```bash&#10;GET http://localhost:8080/api/users&#10;# Xem Response Headers → Chỉ có 1 Access-Control-Allow-Origin&#10;```&#10;&#10;**3. Kiểm tra browser đã clear cache chưa:**&#10;- Browser có thể cache CORS preflight requests&#10;- Phải clear cache hoặc dùng Incognito mode&#10;&#10;**4. Kiểm tra có đang gọi đúng URL không:**&#10;- ✅ Đúng: `http://localhost:8080/api/users` (qua Gateway)&#10;- ❌ Sai: `http://localhost:8081/api/users` (trực tiếp User Service)&#10;&#10;### Lỗi &quot;Failed to fetch&quot; hoặc &quot;Network Error&quot;?&#10;&#10;**1. API Gateway chưa chạy:**&#10;```bash&#10;curl http://localhost:8080/actuator/health&#10;# Phải trả về: {&quot;status&quot;:&quot;UP&quot;}&#10;```&#10;&#10;**2. Services chưa đăng ký với Eureka:**&#10;- Vào http://localhost:8761&#10;- Kiểm tra danh sách services&#10;- Nếu không thấy → restart services theo thứ tự: Eureka → Gateway → User Service&#10;&#10;**3. Port bị chiếm:**&#10;```bash&#10;# Windows - Check port&#10;netstat -ano | findstr :8080&#10;netstat -ano | findstr :8081&#10;&#10;# Nếu có process khác đang dùng → kill process hoặc đổi port&#10;```&#10;&#10;##  LƯU Ý QUAN TRỌNG&#10;&#10;### Khi dùng API Gateway:&#10;1. ✅ **CHỈ Gateway** xử lý CORS&#10;2. ❌ **Backend services** KHÔNG được có `@CrossOrigin`&#10;3. ✅ Frontend gọi qua Gateway (port 8080)&#10;4. ✅ Postman test qua Gateway để đảm bảo đúng&#10;&#10;### Thứ tự khởi động services:&#10;```&#10;1. Eureka Service (8761)  ← Service Discovery&#10;2. API Gateway (8080)      ← Đợi 15-20s sau Eureka&#10;3. User Service (8081)     ← Đợi 10s sau Gateway&#10;```&#10;&#10;### Kiểm tra health:&#10;```bash&#10;# Eureka&#10;curl http://localhost:8761&#10;&#10;# API Gateway&#10;curl http://localhost:8080/actuator/health&#10;&#10;# User Service (qua Gateway)&#10;curl http://localhost:8080/api/users&#10;```&#10;&#10;## ✅ CHECKLIST SAU KHI SỬA&#10;&#10;- [ ] User Service đã restart (không còn @CrossOrigin)&#10;- [ ] API Gateway đang chạy với config mới&#10;- [ ] Cả 2 services đã đăng ký với Eureka&#10;- [ ] Postman test qua Gateway thành công (chỉ 1 CORS header)&#10;- [ ] Browser cache đã được clear&#10;- [ ] Frontend đã restart&#10;- [ ] DevTools Console không còn lỗi CORS&#10;- [ ] Admin Dashboard hiển thị danh sách users&#10;&#10;##  HOÀN THÀNH!&#10;&#10;Sau khi làm theo các bước trên, lỗi CORS sẽ biến mất và bạn có thể:&#10;- ✅ Xem danh sách users trong Admin Dashboard&#10;- ✅ Search users&#10;- ✅ Toggle user status&#10;- ✅ Delete users&#10;- ✅ Tất cả API calls đều hoạt động bình thường&#10;&#10;---&#10;**Tạo bởi:** GitHub Copilot&#10;**Ngày:** 2025-11-09&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Front_end/foodfast-app/src/index.css">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Front_end/foodfast-app/src/index.css" />
              <option name="originalContent" value="@tailwind base;&#10;@tailwind components;&#10;@tailwind utilities;&#10;&#10;body {&#10;  margin: 0;&#10;  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',&#10;    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',&#10;    sans-serif;&#10;  -webkit-font-smoothing: antialiased;&#10;  -moz-osx-font-smoothing: grayscale;&#10;}&#10;&#10;code {&#10;  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',&#10;    monospace;&#10;}&#10;" />
              <option name="updatedContent" value="@tailwind base;&#10;@tailwind components;&#10;@tailwind utilities;&#10;&#10;/* Leaflet CSS for maps */&#10;@import 'leaflet/dist/leaflet.css';&#10;&#10;body {&#13;&#10;  margin: 0;&#13;&#10;  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',&#13;&#10;    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',&#13;&#10;    sans-serif;&#13;&#10;  -webkit-font-smoothing: antialiased;&#13;&#10;  -moz-osx-font-smoothing: grayscale;&#13;&#10;}&#13;&#10;&#13;&#10;code {&#13;&#10;  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',&#13;&#10;    monospace;&#13;&#10;}&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Front_end/foodfast-app/src/pages/OrdersPage.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Front_end/foodfast-app/src/pages/OrdersPage.js" />
              <option name="originalContent" value="import React, { useState, useEffect, useCallback } from 'react';&#10;import { useNavigate, Link } from 'react-router-dom';&#10;import {&#10;  Package,&#10;  Clock,&#10;  CheckCircle,&#10;  XCircle,&#10;  Truck,&#10;  ChefHat,&#10;  ShoppingBag,&#10;  ArrowLeft,&#10;  User,&#10;  LogOut,&#10;  Settings,&#10;  UtensilsCrossed,&#10;  MapPin,&#10;  Phone,&#10;  Calendar,&#10;  X,&#10;  Plane&#10;} from 'lucide-react';&#10;import { Button } from '../components/ui/button';&#10;import { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card';&#10;import { Badge } from '../components/ui/badge';&#10;import { Separator } from '../components/ui/separator';&#10;import { Avatar, AvatarFallback, AvatarImage } from '../components/ui/avatar';&#10;import {&#10;  DropdownMenu,&#10;  DropdownMenuContent,&#10;  DropdownMenuItem,&#10;  DropdownMenuLabel,&#10;  DropdownMenuSeparator,&#10;  DropdownMenuTrigger,&#10;} from '../components/ui/dropdown-menu';&#10;import {&#10;  Dialog,&#10;  DialogContent,&#10;  DialogDescription,&#10;  DialogHeader,&#10;  DialogTitle,&#10;} from '../components/ui/dialog';&#10;import { toast, Toaster } from 'sonner';&#10;import authService from '../services/authService';&#10;import orderService from '../services/orderService';&#10;import deliveryService from '../services/deliveryService';&#10;&#10;const getStatusColor = (status) =&gt; {&#10;  const colors = {&#10;    NEW: 'bg-blue-100 text-blue-800',&#10;    CONFIRMED: 'bg-yellow-100 text-yellow-800',&#10;    PREPARING: 'bg-purple-100 text-purple-800',&#10;    DELIVERING: 'bg-indigo-100 text-indigo-800',&#10;    DELIVERED: 'bg-green-100 text-green-800',&#10;    CANCELLED: 'bg-red-100 text-red-800',&#10;  };&#10;  return colors[status] || 'bg-gray-100 text-gray-800';&#10;};&#10;&#10;const getStatusIcon = (status) =&gt; {&#10;  const icons = {&#10;    NEW: &lt;ShoppingBag className=&quot;w-4 h-4&quot; /&gt;,&#10;    CONFIRMED: &lt;CheckCircle className=&quot;w-4 h-4&quot; /&gt;,&#10;    PREPARING: &lt;ChefHat className=&quot;w-4 h-4&quot; /&gt;,&#10;    DELIVERING: &lt;Truck className=&quot;w-4 h-4&quot; /&gt;,&#10;    DELIVERED: &lt;Package className=&quot;w-4 h-4&quot; /&gt;,&#10;    CANCELLED: &lt;XCircle className=&quot;w-4 h-4&quot; /&gt;,&#10;  };&#10;  return icons[status] || &lt;Clock className=&quot;w-4 h-4&quot; /&gt;;&#10;};&#10;&#10;const statusText = {&#10;  NEW: 'New Order',&#10;  CONFIRMED: 'Confirmed',&#10;  PREPARING: 'Preparing',&#10;  DELIVERING: 'On the Way',&#10;  DELIVERED: 'Delivered',&#10;  CANCELLED: 'Cancelled',&#10;};&#10;&#10;function OrderCard({ order, onViewDetails }) {&#10;  return (&#10;    &lt;Card className=&quot;hover:shadow-lg transition-shadow cursor-pointer&quot; onClick={() =&gt; onViewDetails(order)}&gt;&#10;      &lt;CardContent className=&quot;p-6&quot;&gt;&#10;        &lt;div className=&quot;flex justify-between items-start mb-4&quot;&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-gray-500&quot;&gt;Order #{order.id}&lt;/p&gt;&#10;            &lt;p className=&quot;text-xs text-gray-400&quot;&gt;&#10;              {new Date(order.createdAt).toLocaleString()}&#10;            &lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;Badge className={`${getStatusColor(order.status)} flex items-center gap-1`}&gt;&#10;            {getStatusIcon(order.status)}&#10;            {statusText[order.status]}&#10;          &lt;/Badge&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;space-y-2 mb-4&quot;&gt;&#10;          {order.orderItems?.slice(0, 2).map((item, index) =&gt; (&#10;            &lt;div key={index} className=&quot;flex justify-between text-sm&quot;&gt;&#10;              &lt;span className=&quot;text-gray-600&quot;&gt;&#10;                {item.quantity}x {item.productName || `Product #${item.productId}`}&#10;              &lt;/span&gt;&#10;              &lt;span className=&quot;font-medium&quot;&gt;${(item.price * item.quantity).toFixed(2)}&lt;/span&gt;&#10;            &lt;/div&gt;&#10;          ))}&#10;          {order.orderItems?.length &gt; 2 &amp;&amp; (&#10;            &lt;p className=&quot;text-xs text-gray-500&quot;&gt;&#10;              +{order.orderItems.length - 2} more items&#10;            &lt;/p&gt;&#10;          )}&#10;        &lt;/div&gt;&#10;&#10;        &lt;Separator className=&quot;my-3&quot; /&gt;&#10;&#10;        &lt;div className=&quot;flex justify-between items-center&quot;&gt;&#10;          &lt;span className=&quot;text-lg font-bold text-orange-600&quot;&gt;&#10;            ${order.totalPrice?.toFixed(2) || '0.00'}&#10;          &lt;/span&gt;&#10;          &lt;Button variant=&quot;outline&quot; size=&quot;sm&quot;&gt;&#10;            View Details&#10;          &lt;/Button&gt;&#10;        &lt;/div&gt;&#10;      &lt;/CardContent&gt;&#10;    &lt;/Card&gt;&#10;  );&#10;}&#10;&#10;export default function OrdersPage() {&#10;  const navigate = useNavigate();&#10;  const [user, setUser] = useState(null);&#10;  const [orders, setOrders] = useState([]);&#10;  const [loading, setLoading] = useState(true);&#10;  const [error, setError] = useState(null);&#10;  const [selectedOrder, setSelectedOrder] = useState(null);&#10;  const [deliveryInfo, setDeliveryInfo] = useState(null);&#10;  const [loadingDelivery, setLoadingDelivery] = useState(false);&#10;  const [showMap, setShowMap] = useState(false);&#10;  const fetchOrders = useCallback(async () =&gt; {&#10;    try {&#10;      setLoading(true);&#10;      setError(null);&#10;&#10;      // Get only current user's orders&#10;      const data = await orderService.getMyOrders();&#10;&#10;      // Sort by newest first&#10;      const sortedOrders = data.sort((a, b) =&gt;&#10;        new Date(b.createdAt) - new Date(a.createdAt)&#10;      );&#10;&#10;      setOrders(sortedOrders);&#10;    } catch (err) {&#10;      console.error('Error fetching orders:', err);&#10;&#10;      // Xử lý lỗi cụ thể hơn&#10;      let errorMessage = 'Failed to load orders. Please try again.';&#10;&#10;      if (err.response) {&#10;        // Server trả về response với error&#10;        if (err.response.status === 400) {&#10;          errorMessage = 'Invalid request. Please try logging in again.';&#10;        } else if (err.response.status === 401) {&#10;          errorMessage = 'Your session has expired. Please login again.';&#10;          setTimeout(() =&gt; navigate('/login'), 2000);&#10;        } else if (err.response.status === 404) {&#10;          errorMessage = 'Orders service is not available.';&#10;        } else if (err.response.status &gt;= 500) {&#10;          errorMessage = 'Server error. Our team has been notified.';&#10;        }&#10;      } else if (err.request) {&#10;        // Request được gửi nhưng không nhận được response&#10;        errorMessage = 'Cannot connect to server. Please check your internet connection.';&#10;      }&#10;&#10;      setError(errorMessage);&#10;      toast.error(errorMessage);&#10;    } finally {&#10;      setLoading(false);&#10;    }&#10;  }, [navigate]);&#10;&#10;  useEffect(() =&gt; {&#10;    const currentUser = authService.getCurrentUser();&#10;    if (!currentUser) {&#10;      toast.error('Please login to view orders');&#10;      navigate('/login');&#10;      return;&#10;    }&#10;    setUser(currentUser);&#10;    fetchOrders();&#10;  }, [navigate, fetchOrders]);&#10;&#10;  const handleViewDetails = async (order) =&gt; {&#10;    setSelectedOrder(order);&#10;    &#10;    // Fetch delivery info if order is PREPARING, DELIVERING, or DELIVERED&#10;    if (['PREPARING', 'DELIVERING', 'DELIVERED'].includes(order.status)) {&#10;      setLoadingDelivery(true);&#10;      try {&#10;        const delivery = await deliveryService.getDeliveryByOrderId(order.id);&#10;        setDeliveryInfo(delivery);&#10;      } catch (error) {&#10;        console.error('Error fetching delivery info:', error);&#10;        // Không hiển thị error nếu chưa có delivery info&#10;        setDeliveryInfo(null);&#10;      } finally {&#10;        setLoadingDelivery(false);&#10;      }&#10;    } else {&#10;      setDeliveryInfo(null);&#10;    }&#10;  };&#10;&#10;  const handleCloseDialog = () =&gt; {&#10;    setSelectedOrder(null);&#10;    setDeliveryInfo(null);&#10;    setShowMap(false);&#10;  };&#10;&#10;    authService.logout();&#10;    toast.success('Logged out successfully');&#10;    navigate('/login');&#10;  };&#10;&#10;  const getUserInitials = () =&gt; {&#10;    if (!user) return 'U';&#10;    if (user.fullName) {&#10;      const names = user.fullName.split(' ');&#10;      return names.length &gt;= 2&#10;        ? `${names[0][0]}${names[names.length - 1][0]}`.toUpperCase()&#10;        : names[0][0].toUpperCase();&#10;    }&#10;    return user.username ? user.username[0].toUpperCase() : 'U';&#10;  };&#10;&#10;  return (&#10;    &lt;div className=&quot;min-h-screen bg-gray-50&quot;&gt;&#10;      &lt;Toaster position=&quot;top-center&quot; /&gt;&#10;&#10;      {/* Header */}&#10;      &lt;header className=&quot;bg-white shadow-sm sticky top-0 z-50&quot;&gt;&#10;        &lt;div className=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;&#10;          &lt;div className=&quot;flex items-center justify-between h-16&quot;&gt;&#10;            &lt;Link to=&quot;/&quot; className=&quot;flex items-center gap-2&quot;&gt;&#10;              &lt;div className=&quot;bg-orange-600 p-1.5 rounded-lg&quot;&gt;&#10;                &lt;UtensilsCrossed className=&quot;w-5 h-5 text-white&quot; /&gt;&#10;              &lt;/div&gt;&#10;              &lt;span className=&quot;text-xl font-bold text-orange-600&quot;&gt;FoodFast&lt;/span&gt;&#10;            &lt;/Link&gt;&#10;&#10;            &lt;nav className=&quot;hidden md:flex items-center gap-6&quot;&gt;&#10;              &lt;Link to=&quot;/products&quot; className=&quot;text-gray-700 hover:text-orange-600 transition-colors&quot;&gt;&#10;                Menu&#10;              &lt;/Link&gt;&#10;              &lt;Link to=&quot;/orders&quot; className=&quot;text-orange-600 font-medium&quot;&gt;&#10;                My Orders&#10;              &lt;/Link&gt;&#10;            &lt;/nav&gt;&#10;&#10;            &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;              {user &amp;&amp; (&#10;                &lt;DropdownMenu&gt;&#10;                  &lt;DropdownMenuTrigger asChild&gt;&#10;                    &lt;Button variant=&quot;ghost&quot; className=&quot;relative h-9 w-9 rounded-full&quot;&gt;&#10;                      &lt;Avatar className=&quot;h-9 w-9&quot;&gt;&#10;                        &lt;AvatarImage src={user.avatar} alt={user.fullName || user.username} /&gt;&#10;                        &lt;AvatarFallback className=&quot;bg-orange-600 text-white&quot;&gt;&#10;                          {getUserInitials()}&#10;                        &lt;/AvatarFallback&gt;&#10;                      &lt;/Avatar&gt;&#10;                    &lt;/Button&gt;&#10;                  &lt;/DropdownMenuTrigger&gt;&#10;                  &lt;DropdownMenuContent className=&quot;w-56&quot; align=&quot;end&quot;&gt;&#10;                    &lt;DropdownMenuLabel&gt;&#10;                      &lt;div className=&quot;flex flex-col space-y-1&quot;&gt;&#10;                        &lt;p className=&quot;text-sm font-medium&quot;&gt;{user.fullName || user.username}&lt;/p&gt;&#10;                        &lt;p className=&quot;text-xs text-gray-500&quot;&gt;{user.email}&lt;/p&gt;&#10;                      &lt;/div&gt;&#10;                    &lt;/DropdownMenuLabel&gt;&#10;                    &lt;DropdownMenuSeparator /&gt;&#10;                    &lt;DropdownMenuItem onClick={() =&gt; navigate('/profile')}&gt;&#10;                      &lt;User className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                      Profile&#10;                    &lt;/DropdownMenuItem&gt;&#10;                    &lt;DropdownMenuItem onClick={() =&gt; navigate('/orders')}&gt;&#10;                      &lt;Package className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                      My Orders&#10;                    &lt;/DropdownMenuItem&gt;&#10;                    &lt;DropdownMenuItem onClick={() =&gt; navigate('/settings')}&gt;&#10;                      &lt;Settings className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                      Settings&#10;                    &lt;/DropdownMenuItem&gt;&#10;                    &lt;DropdownMenuSeparator /&gt;&#10;                    &lt;DropdownMenuItem onClick={handleLogout} className=&quot;text-red-600&quot;&gt;&#10;                      &lt;LogOut className=&quot;mr-2 h-4 w-4&quot; /&gt;&#10;                      Logout&#10;                    &lt;/DropdownMenuItem&gt;&#10;                  &lt;/DropdownMenuContent&gt;&#10;                &lt;/DropdownMenu&gt;&#10;              )}&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      &lt;/header&gt;&#10;&#10;      {/* Main Content */}&#10;      &lt;main className=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8&quot;&gt;&#10;        &lt;div className=&quot;mb-6 flex items-center justify-between&quot;&gt;&#10;          &lt;div&gt;&#10;            &lt;h1 className=&quot;text-3xl font-bold text-gray-900&quot;&gt;My Orders&lt;/h1&gt;&#10;            &lt;p className=&quot;text-gray-600 mt-1&quot;&gt;Track and manage your food orders&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;Button&#10;            variant=&quot;outline&quot;&#10;            onClick={() =&gt; navigate('/products')}&#10;            className=&quot;flex items-center gap-2&quot;&#10;          &gt;&#10;            &lt;ArrowLeft className=&quot;w-4 h-4&quot; /&gt;&#10;            Continue Shopping&#10;          &lt;/Button&gt;&#10;        &lt;/div&gt;&#10;&#10;        {loading ? (&#10;          &lt;div className=&quot;text-center py-16&quot;&gt;&#10;            &lt;div className=&quot;inline-block animate-spin rounded-full h-12 w-12 border-4 border-gray-300 border-t-orange-600&quot;&gt;&lt;/div&gt;&#10;            &lt;p className=&quot;text-gray-600 text-lg mt-4&quot;&gt;Loading your orders...&lt;/p&gt;&#10;          &lt;/div&gt;&#10;        ) : error ? (&#10;          &lt;Card className=&quot;p-12 text-center&quot;&gt;&#10;            &lt;XCircle className=&quot;w-20 h-20 mx-auto text-red-400 mb-4&quot; /&gt;&#10;            &lt;h2 className=&quot;text-2xl font-bold text-gray-900 mb-2&quot;&gt;{error}&lt;/h2&gt;&#10;            &lt;Button&#10;              onClick={fetchOrders}&#10;              className=&quot;mt-4 bg-orange-600 hover:bg-orange-700&quot;&#10;            &gt;&#10;              Try Again&#10;            &lt;/Button&gt;&#10;          &lt;/Card&gt;&#10;        ) : orders.length === 0 ? (&#10;          &lt;Card className=&quot;p-12 text-center&quot;&gt;&#10;            &lt;ShoppingBag className=&quot;w-20 h-20 mx-auto text-gray-300 mb-4&quot; /&gt;&#10;            &lt;h2 className=&quot;text-2xl font-bold text-gray-900 mb-2&quot;&gt;No orders yet&lt;/h2&gt;&#10;            &lt;p className=&quot;text-gray-600 mb-6&quot;&gt;Start ordering delicious food!&lt;/p&gt;&#10;            &lt;Button&#10;              onClick={() =&gt; navigate('/products')}&#10;              className=&quot;bg-orange-600 hover:bg-orange-700&quot;&#10;            &gt;&#10;              Browse Menu&#10;            &lt;/Button&gt;&#10;          &lt;/Card&gt;&#10;        ) : (&#10;          &lt;div className=&quot;grid md:grid-cols-2 lg:grid-cols-3 gap-6&quot;&gt;&#10;            {orders.map((order) =&gt; (&#10;              &lt;OrderCard&#10;                key={order.id}&#10;                order={order}&#10;                onViewDetails={handleViewDetails}&#10;              /&gt;&#10;            ))}&#10;          &lt;/div&gt;&#10;        )}&#10;&#10;        {/* Order Details Dialog */}&#10;        {selectedOrder &amp;&amp; (&#10;          &lt;Dialog open={Boolean(selectedOrder)} onOpenChange={handleCloseDialog}&gt;&#10;            &lt;DialogContent className=&quot;max-w-2xl max-h-[90vh] overflow-y-auto p-6 mx-auto rounded-lg shadow-lg bg-white&quot;&gt;&#10;              &lt;DialogHeader&gt;&#10;                &lt;div className=&quot;flex items-center justify-between&quot;&gt;&#10;                  &lt;DialogTitle className=&quot;text-lg font-bold text-gray-900&quot;&gt;&#10;                    Order Details&#10;                  &lt;/DialogTitle&gt;&#10;                  &lt;Button&#10;                    variant=&quot;ghost&quot;&#10;                    onClick={handleCloseDialog}&#10;                    className=&quot;rounded-full p-2 hover:bg-gray-100&quot;&#10;                  &gt;&#10;                    &lt;X className=&quot;w-5 h-5 text-gray-500&quot; /&gt;&#10;                  &lt;/Button&gt;&#10;                &lt;/div&gt;&#10;              &lt;/DialogHeader&gt;&#10;              &lt;DialogDescription className=&quot;mt-4 text-sm text-gray-700&quot;&gt;&#10;                &lt;div className=&quot;space-y-4&quot;&gt;&#10;                  &lt;div&gt;&#10;                    &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#10;                      Order ID&#10;                    &lt;/span&gt;&#10;                    &lt;span className=&quot;block text-sm font-medium text-gray-900&quot;&gt;&#10;                      {selectedOrder.id}&#10;                    &lt;/span&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;div&gt;&#10;                    &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#10;                      Order Date&#10;                    &lt;/span&gt;&#10;                    &lt;span className=&quot;block text-sm font-medium text-gray-900&quot;&gt;&#10;                      {new Date(selectedOrder.createdAt).toLocaleString()}&#10;                    &lt;/span&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;div&gt;&#10;                    &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#10;                      Status&#10;                    &lt;/span&gt;&#10;                    &lt;Badge className={`${getStatusColor(selectedOrder.status)} inline-flex items-center gap-1`}&gt;&#10;                      {getStatusIcon(selectedOrder.status)}&#10;                      {statusText[selectedOrder.status]}&#10;                    &lt;/Badge&gt;&#10;                  &lt;/div&gt;&#10;&#10;                  {/* Thêm thông tin Payment */}&#10;                  {selectedOrder.paymentMethod &amp;&amp; (&#10;                    &lt;div&gt;&#10;                      &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#10;                        Payment Method&#10;                      &lt;/span&gt;&#10;                      &lt;span className=&quot;block text-sm font-medium text-gray-900 capitalize&quot;&gt;&#10;                        {selectedOrder.paymentMethod}&#10;                      &lt;/span&gt;&#10;                    &lt;/div&gt;&#10;                  )}&#10;&#10;                  {selectedOrder.paymentStatus &amp;&amp; (&#10;                    &lt;div&gt;&#10;                      &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#10;                        Payment Status&#10;                      &lt;/span&gt;&#10;                      &lt;Badge className={&#10;                        selectedOrder.paymentStatus === 'SUCCESS'&#10;                          ? 'bg-green-100 text-green-800'&#10;                          : selectedOrder.paymentStatus === 'FAILED'&#10;                          ? 'bg-red-100 text-red-800'&#10;                          : 'bg-yellow-100 text-yellow-800'&#10;                      }&gt;&#10;                        {selectedOrder.paymentStatus}&#10;                      &lt;/Badge&gt;&#10;                    &lt;/div&gt;&#10;                  )}&#10;&#10;                  {/* Thông tin Delivery &amp; Drone */}&#10;                  {['PREPARING', 'DELIVERING', 'DELIVERED'].includes(selectedOrder.status) &amp;&amp; (&#10;                    &lt;&gt;&#10;                      &lt;Separator className=&quot;my-4&quot; /&gt;&#10;                      &lt;div className=&quot;bg-blue-50 p-4 rounded-lg&quot;&gt;&#10;                        {loadingDelivery ? (&#10;                          &lt;div className=&quot;text-center py-4&quot;&gt;&#10;                            &lt;div className=&quot;inline-block animate-spin rounded-full h-8 w-8 border-4 border-gray-300 border-t-blue-600&quot;&gt;&lt;/div&gt;&#10;                            &lt;p className=&quot;text-gray-600 text-sm mt-2&quot;&gt;Đang tải thông tin giao hàng...&lt;/p&gt;&#10;                      &lt;div className=&quot;bg-blue-50 p-4 rounded-lg&quot;&gt;&#10;                        &lt;div className=&quot;flex items-center gap-2 mb-3&quot;&gt;&#10;                          &lt;Plane className=&quot;w-5 h-5 text-blue-600&quot; /&gt;&#10;                          &lt;span className=&quot;font-semibold text-blue-900&quot;&gt;Delivery Information&lt;/span&gt;&#10;                        &lt;/div&gt;&#10;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;space-y-3&quot;&gt;&#10;                            &lt;div&gt;&#10;                              &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                Drone ID&#10;                              &lt;/span&gt;&#10;                              &lt;span className=&quot;block text-sm font-medium text-gray-900&quot;&gt;&#10;                                {deliveryInfo.droneId}&#10;                              &lt;/span&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div&gt;&#10;                              &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                Delivery Status&#10;                              &lt;/span&gt;&#10;                              &lt;Badge className={deliveryService.getDeliveryStatusColor(deliveryInfo.status)}&gt;&#10;                                {deliveryService.formatDeliveryStatus(deliveryInfo.status)}&#10;                          &lt;p className=&quot;text-sm text-gray-600&quot;&gt;&#10;                            Delivery information will be available once the restaurant prepares your order.&#10;                            {deliveryInfo.assignedAt &amp;&amp; (&#10;                              &lt;div&gt;&#10;                                &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                  Assigned At&#10;                                &lt;/span&gt;&#10;                                &lt;span className=&quot;block text-sm text-gray-900&quot;&gt;&#10;                                  {new Date(deliveryInfo.assignedAt).toLocaleString()}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                            )}&#10;                            {deliveryInfo.pickedUpAt &amp;&amp; (&#10;                              &lt;div&gt;&#10;                                &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                  Picked Up At&#10;                                &lt;/span&gt;&#10;                                &lt;span className=&quot;block text-sm text-gray-900&quot;&gt;&#10;                                  {new Date(deliveryInfo.pickedUpAt).toLocaleString()}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                                {deliveryInfo.droneId}&#10;                              &lt;/span&gt;&#10;                            &lt;/div&gt;&#10;                            &lt;div&gt;&#10;                              &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                Delivery Status&#10;                              &lt;/span&gt;&#10;                              &lt;Badge className={deliveryService.getDeliveryStatusColor(deliveryInfo.status)}&gt;&#10;                                {deliveryService.formatDeliveryStatus(deliveryInfo.status)}&#10;                              &lt;/Badge&gt;&#10;                            &lt;/div&gt;&#10;                            {deliveryInfo.assignedAt &amp;&amp; (&#10;                              &lt;div&gt;&#10;                                &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                  Assigned At&#10;                                &lt;/span&gt;&#10;                                &lt;span className=&quot;block text-sm text-gray-900&quot;&gt;&#10;                              &lt;/div&gt;&#10;                            )}&#10;                            {deliveryInfo.completedAt &amp;&amp; (&#10;                              &lt;div&gt;&#10;                                &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                  Delivered At&#10;                                &lt;/span&gt;&#10;                                &lt;span className=&quot;block text-sm text-gray-900&quot;&gt;&#10;                                  {new Date(deliveryInfo.completedAt).toLocaleString()}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                            )}&#10;                            {deliveryInfo.deliveryAddress &amp;&amp; (&#10;                              &lt;div&gt;&#10;                                &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                  Delivery Address&#10;                                &lt;/span&gt;&#10;                                &lt;span className=&quot;block text-sm text-gray-900&quot;&gt;&#10;                                  {deliveryInfo.deliveryAddress}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                            )}&#10;                          &lt;/div&gt;&#10;                        ) : (&#10;                          &lt;p className=&quot;text-sm text-gray-600&quot;&gt;&#10;                            Delivery information will be available once the restaurant prepares your order.&#10;                          &lt;/p&gt;&#10;                        )}&#10;                      &lt;/div&gt;&#10;                            {/* Track on Map Button */}&#10;                            {deliveryInfo.currentLat &amp;&amp; deliveryInfo.currentLng &amp;&amp; (&#10;                              &lt;button&#10;                                onClick={() =&gt; setShowMap(true)}&#10;                                className=&quot;mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors&quot;&#10;                              &gt;&#10;                                &lt;Map className=&quot;w-5 h-5&quot; /&gt;&#10;                                Theo dõi trên bản đồ&#10;                              &lt;/button&gt;&#10;                            {deliveryInfo.completedAt &amp;&amp; (&#10;                              &lt;div&gt;&#10;                                &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                  Delivered At&#10;                                &lt;/span&gt;&#10;                                &lt;span className=&quot;block text-sm text-gray-900&quot;&gt;&#10;                                  {new Date(deliveryInfo.completedAt).toLocaleString()}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                            )}&#10;                            {deliveryInfo.deliveryAddress &amp;&amp; (&#10;                              &lt;div&gt;&#10;                                &lt;span className=&quot;block text-xs font-semibold text-gray-600&quot;&gt;&#10;                                  Delivery Address&#10;                                &lt;/span&gt;&#10;                                &lt;span className=&quot;block text-sm text-gray-900&quot;&gt;&#10;                                  {deliveryInfo.deliveryAddress}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                            )}&#10;                          &lt;/div&gt;&#10;                          &lt;/&gt;&#10;                        ) : (&#10;                          &lt;p className=&quot;text-sm text-gray-600 text-center&quot;&gt;&#10;                            Thông tin giao hàng sẽ có sau khi nhà hàng chuẩn bị xong đơn hàng của bạn.&#10;                          &lt;/p&gt;&#10;                        )}&#10;                      &lt;/div&gt;&#10;                    &lt;/&gt;&#10;                  )}&#10;                &lt;/div&gt;&#10;&#10;                &lt;Separator className=&quot;my-4&quot; /&gt;&#10;&#10;                &lt;div&gt;&#10;                  &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#10;                    Items&#10;                  &lt;/span&gt;&#10;                  &lt;div className=&quot;space-y-2&quot;&gt;&#10;                    {selectedOrder.orderItems?.map((item, index) =&gt; (&#10;                      &lt;div key={index} className=&quot;flex justify-between text-sm&quot;&gt;&#10;                        &lt;span className=&quot;text-gray-600&quot;&gt;&#10;                          {item.quantity}x {item.productName || `Product #${item.productId}`}&#10;                        &lt;/span&gt;&#10;                        &lt;span className=&quot;font-medium&quot;&gt;${(item.price * item.quantity).toFixed(2)}&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                    ))}&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;Separator className=&quot;my-4&quot; /&gt;&#10;&#10;                &lt;div className=&quot;flex justify-between items-center&quot;&gt;&#10;                  &lt;span className=&quot;text-lg font-bold text-orange-600&quot;&gt;&#10;                    Total: ${selectedOrder.totalPrice?.toFixed(2) || '0.00'}&#10;                  &lt;/span&gt;&#10;                &lt;/div&gt;&#10;              &lt;/DialogDescription&gt;&#10;            &lt;/DialogContent&gt;&#10;          &lt;/Dialog&gt;&#10;        )}&#10;&#10;        {/* Drone Map Modal */}&#10;        {showMap &amp;&amp; deliveryInfo &amp;&amp; (&#10;          &lt;div className=&quot;fixed inset-0 bg-black bg-opacity-75 z-[9999] flex items-center justify-center p-4&quot;&gt;&#10;            &lt;div className=&quot;bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden&quot;&gt;&#10;              &lt;DroneMap&#10;                delivery={deliveryInfo}&#10;                onClose={() =&gt; setShowMap(false)}&#10;              /&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        )}&#10;      &lt;/main&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
              <option name="updatedContent" value="import React, { useState, useEffect, useCallback } from 'react';&#13;&#10;import { useNavigate, Link } from 'react-router-dom';&#13;&#10;import {&#13;&#10;  Package,&#13;&#10;  Clock,&#13;&#10;  CheckCircle,&#13;&#10;  XCircle,&#13;&#10;  Truck,&#13;&#10;  ChefHat,&#13;&#10;  ShoppingBag,&#13;&#10;  ArrowLeft,&#13;&#10;  User,&#13;&#10;  LogOut,&#13;&#10;  Settings,&#13;&#10;  UtensilsCrossed,&#13;&#10;  MapPin,&#13;&#10;  Phone,&#13;&#10;  Calendar,&#13;&#10;  X,&#13;&#10;  Plane,&#13;&#10;  Map&#13;&#10;} from 'lucide-react';&#13;&#10;import { Button } from '../components/ui/button';&#13;&#10;import { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card';&#13;&#10;import { Badge } from '../components/ui/badge';&#13;&#10;import { Separator } from '../components/ui/separator';&#13;&#10;import { Avatar, AvatarFallback, AvatarImage } from '../components/ui/avatar';&#13;&#10;import {&#13;&#10;  DropdownMenu,&#13;&#10;  DropdownMenuContent,&#13;&#10;  DropdownMenuItem,&#13;&#10;  DropdownMenuLabel,&#13;&#10;  DropdownMenuSeparator,&#13;&#10;  DropdownMenuTrigger,&#13;&#10;} from '../components/ui/dropdown-menu';&#13;&#10;import {&#13;&#10;  Dialog,&#13;&#10;  DialogContent,&#13;&#10;  DialogDescription,&#13;&#10;  DialogHeader,&#13;&#10;  DialogTitle,&#13;&#10;} from '../components/ui/dialog';&#13;&#10;import { toast, Toaster } from 'sonner';&#13;&#10;import authService from '../services/authService';&#13;&#10;import orderService from '../services/orderService';&#13;&#10;import deliveryService from '../services/deliveryService';&#13;&#10;import DeliveryInfo from '../components/DeliveryInfo';&#13;&#10;import DroneMap from '../components/DroneMap';&#13;&#10;&#13;&#10;const getStatusColor = (status) =&gt; {&#13;&#10;  const colors = {&#13;&#10;    NEW: 'bg-blue-100 text-blue-800',&#13;&#10;    CONFIRMED: 'bg-yellow-100 text-yellow-800',&#13;&#10;    PREPARING: 'bg-purple-100 text-purple-800',&#13;&#10;    DELIVERING: 'bg-indigo-100 text-indigo-800',&#13;&#10;    DELIVERED: 'bg-green-100 text-green-800',&#13;&#10;    CANCELLED: 'bg-red-100 text-red-800',&#13;&#10;  };&#13;&#10;  return colors[status] || 'bg-gray-100 text-gray-800';&#13;&#10;};&#13;&#10;&#13;&#10;const getStatusIcon = (status) =&gt; {&#13;&#10;  const icons = {&#13;&#10;    NEW: &lt;ShoppingBag className=&quot;w-4 h-4&quot; /&gt;,&#13;&#10;    CONFIRMED: &lt;CheckCircle className=&quot;w-4 h-4&quot; /&gt;,&#13;&#10;    PREPARING: &lt;ChefHat className=&quot;w-4 h-4&quot; /&gt;,&#13;&#10;    DELIVERING: &lt;Truck className=&quot;w-4 h-4&quot; /&gt;,&#13;&#10;    DELIVERED: &lt;Package className=&quot;w-4 h-4&quot; /&gt;,&#13;&#10;    CANCELLED: &lt;XCircle className=&quot;w-4 h-4&quot; /&gt;,&#13;&#10;  };&#13;&#10;  return icons[status] || &lt;Clock className=&quot;w-4 h-4&quot; /&gt;;&#13;&#10;};&#13;&#10;&#13;&#10;const statusText = {&#13;&#10;  NEW: 'New Order',&#13;&#10;  CONFIRMED: 'Confirmed',&#13;&#10;  PREPARING: 'Preparing',&#13;&#10;  DELIVERING: 'On the Way',&#13;&#10;  DELIVERED: 'Delivered',&#13;&#10;  CANCELLED: 'Cancelled',&#13;&#10;};&#13;&#10;&#13;&#10;function OrderCard({ order, onViewDetails }) {&#13;&#10;  return (&#13;&#10;    &lt;Card className=&quot;hover:shadow-lg transition-shadow cursor-pointer&quot; onClick={() =&gt; onViewDetails(order)}&gt;&#13;&#10;      &lt;CardContent className=&quot;p-6&quot;&gt;&#13;&#10;        &lt;div className=&quot;flex justify-between items-start mb-4&quot;&gt;&#13;&#10;          &lt;div&gt;&#13;&#10;            &lt;p className=&quot;text-sm text-gray-500&quot;&gt;Order #{order.id}&lt;/p&gt;&#13;&#10;            &lt;p className=&quot;text-xs text-gray-400&quot;&gt;&#13;&#10;              {new Date(order.createdAt).toLocaleString()}&#13;&#10;            &lt;/p&gt;&#13;&#10;          &lt;/div&gt;&#13;&#10;          &lt;Badge className={`${getStatusColor(order.status)} flex items-center gap-1`}&gt;&#13;&#10;            {getStatusIcon(order.status)}&#13;&#10;            {statusText[order.status]}&#13;&#10;          &lt;/Badge&gt;&#13;&#10;        &lt;/div&gt;&#13;&#10;&#13;&#10;        &lt;div className=&quot;space-y-2 mb-4&quot;&gt;&#13;&#10;          {order.orderItems?.slice(0, 2).map((item, index) =&gt; (&#13;&#10;            &lt;div key={index} className=&quot;flex justify-between text-sm&quot;&gt;&#13;&#10;              &lt;span className=&quot;text-gray-600&quot;&gt;&#13;&#10;                {item.quantity}x {item.productName || `Product #${item.productId}`}&#13;&#10;              &lt;/span&gt;&#13;&#10;              &lt;span className=&quot;font-medium&quot;&gt;${(item.price * item.quantity).toFixed(2)}&lt;/span&gt;&#13;&#10;            &lt;/div&gt;&#13;&#10;          ))}&#13;&#10;          {order.orderItems?.length &gt; 2 &amp;&amp; (&#13;&#10;            &lt;p className=&quot;text-xs text-gray-500&quot;&gt;&#13;&#10;              +{order.orderItems.length - 2} more items&#13;&#10;            &lt;/p&gt;&#13;&#10;          )}&#13;&#10;        &lt;/div&gt;&#13;&#10;&#13;&#10;        &lt;Separator className=&quot;my-3&quot; /&gt;&#13;&#10;&#13;&#10;        &lt;div className=&quot;flex justify-between items-center&quot;&gt;&#13;&#10;          &lt;span className=&quot;text-lg font-bold text-orange-600&quot;&gt;&#13;&#10;            ${order.totalPrice?.toFixed(2) || '0.00'}&#13;&#10;          &lt;/span&gt;&#13;&#10;          &lt;Button variant=&quot;outline&quot; size=&quot;sm&quot;&gt;&#13;&#10;            View Details&#13;&#10;          &lt;/Button&gt;&#13;&#10;        &lt;/div&gt;&#13;&#10;      &lt;/CardContent&gt;&#13;&#10;    &lt;/Card&gt;&#13;&#10;  );&#13;&#10;}&#13;&#10;&#13;&#10;export default function OrdersPage() {&#13;&#10;  const navigate = useNavigate();&#13;&#10;  const [user, setUser] = useState(null);&#13;&#10;  const [orders, setOrders] = useState([]);&#13;&#10;  const [loading, setLoading] = useState(true);&#13;&#10;  const [error, setError] = useState(null);&#13;&#10;  const [selectedOrder, setSelectedOrder] = useState(null);&#13;&#10;  const [deliveryInfo, setDeliveryInfo] = useState(null);&#13;&#10;  const [loadingDelivery, setLoadingDelivery] = useState(false);&#13;&#10;  const [showMap, setShowMap] = useState(false);&#13;&#10;&#13;&#10;  const fetchOrders = useCallback(async () =&gt; {&#13;&#10;    try {&#13;&#10;      setLoading(true);&#13;&#10;      setError(null);&#13;&#10;&#13;&#10;      // Get only current user's orders&#13;&#10;      const data = await orderService.getMyOrders();&#13;&#10;&#13;&#10;      // Sort by newest first&#13;&#10;      const sortedOrders = data.sort((a, b) =&gt;&#13;&#10;        new Date(b.createdAt) - new Date(a.createdAt)&#13;&#10;      );&#13;&#10;&#13;&#10;      setOrders(sortedOrders);&#13;&#10;    } catch (err) {&#13;&#10;      console.error('Error fetching orders:', err);&#13;&#10;&#13;&#10;      // Xử lý lỗi cụ thể hơn&#13;&#10;      let errorMessage = 'Failed to load orders. Please try again.';&#13;&#10;&#13;&#10;      if (err.response) {&#13;&#10;        // Server trả về response với error&#13;&#10;        if (err.response.status === 400) {&#13;&#10;          errorMessage = 'Invalid request. Please try logging in again.';&#13;&#10;        } else if (err.response.status === 401) {&#13;&#10;          errorMessage = 'Your session has expired. Please login again.';&#13;&#10;          setTimeout(() =&gt; navigate('/login'), 2000);&#13;&#10;        } else if (err.response.status === 404) {&#13;&#10;          errorMessage = 'Orders service is not available.';&#13;&#10;        } else if (err.response.status &gt;= 500) {&#13;&#10;          errorMessage = 'Server error. Our team has been notified.';&#13;&#10;        }&#13;&#10;      } else if (err.request) {&#13;&#10;        // Request được gửi nhưng không nhận được response&#13;&#10;        errorMessage = 'Cannot connect to server. Please check your internet connection.';&#13;&#10;      }&#13;&#10;&#13;&#10;      setError(errorMessage);&#13;&#10;      toast.error(errorMessage);&#13;&#10;    } finally {&#13;&#10;      setLoading(false);&#13;&#10;    }&#13;&#10;  }, [navigate]);&#13;&#10;&#13;&#10;  useEffect(() =&gt; {&#13;&#10;    const currentUser = authService.getCurrentUser();&#13;&#10;    if (!currentUser) {&#13;&#10;      toast.error('Please login to view orders');&#13;&#10;      navigate('/login');&#13;&#10;      return;&#13;&#10;    }&#13;&#10;    setUser(currentUser);&#13;&#10;    fetchOrders();&#13;&#10;  }, [navigate, fetchOrders]);&#13;&#10;&#13;&#10;  const handleViewDetails = async (order) =&gt; {&#13;&#10;    setSelectedOrder(order);&#13;&#10;    &#13;&#10;    // Fetch delivery info if order is PREPARING, DELIVERING, or DELIVERED&#13;&#10;    if (['PREPARING', 'DELIVERING', 'DELIVERED'].includes(order.status)) {&#13;&#10;      setLoadingDelivery(true);&#13;&#10;      try {&#13;&#10;        const delivery = await deliveryService.getDeliveryByOrderId(order.id);&#13;&#10;        setDeliveryInfo(delivery);&#13;&#10;      } catch (error) {&#13;&#10;        console.error('Error fetching delivery info:', error);&#13;&#10;        // Không hiển thị error nếu chưa có delivery info&#13;&#10;        setDeliveryInfo(null);&#13;&#10;      } finally {&#13;&#10;        setLoadingDelivery(false);&#13;&#10;      }&#13;&#10;    } else {&#13;&#10;      setDeliveryInfo(null);&#13;&#10;    }&#13;&#10;  };&#13;&#10;&#13;&#10;  const handleCloseDialog = () =&gt; {&#13;&#10;    setSelectedOrder(null);&#13;&#10;    setDeliveryInfo(null);&#13;&#10;    setShowMap(false);&#13;&#10;  };&#13;&#10;&#13;&#10;  const handleLogout = () =&gt; {&#13;&#10;    authService.logout();&#13;&#10;    toast.success('Logged out successfully');&#13;&#10;    navigate('/login');&#13;&#10;  };&#13;&#10;&#13;&#10;  const getUserInitials = () =&gt; {&#13;&#10;    if (!user) return 'U';&#13;&#10;    if (user.fullName) {&#13;&#10;      const names = user.fullName.split(' ');&#13;&#10;      return names.length &gt;= 2&#13;&#10;        ? `${names[0][0]}${names[names.length - 1][0]}`.toUpperCase()&#13;&#10;        : names[0][0].toUpperCase();&#13;&#10;    }&#13;&#10;    return user.username ? user.username[0].toUpperCase() : 'U';&#13;&#10;  };&#13;&#10;&#13;&#10;  return (&#13;&#10;    &lt;div className=&quot;min-h-screen bg-gray-50&quot;&gt;&#13;&#10;      &lt;Toaster position=&quot;top-center&quot; /&gt;&#13;&#10;&#13;&#10;      {/* Header */}&#13;&#10;      &lt;header className=&quot;bg-white shadow-sm sticky top-0 z-50&quot;&gt;&#13;&#10;        &lt;div className=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;&#13;&#10;          &lt;div className=&quot;flex items-center justify-between h-16&quot;&gt;&#13;&#10;            &lt;Link to=&quot;/&quot; className=&quot;flex items-center gap-2&quot;&gt;&#13;&#10;              &lt;div className=&quot;bg-orange-600 p-1.5 rounded-lg&quot;&gt;&#13;&#10;                &lt;UtensilsCrossed className=&quot;w-5 h-5 text-white&quot; /&gt;&#13;&#10;              &lt;/div&gt;&#13;&#10;              &lt;span className=&quot;text-xl font-bold text-orange-600&quot;&gt;FoodFast&lt;/span&gt;&#13;&#10;            &lt;/Link&gt;&#13;&#10;&#13;&#10;            &lt;nav className=&quot;hidden md:flex items-center gap-6&quot;&gt;&#13;&#10;              &lt;Link to=&quot;/products&quot; className=&quot;text-gray-700 hover:text-orange-600 transition-colors&quot;&gt;&#13;&#10;                Menu&#13;&#10;              &lt;/Link&gt;&#13;&#10;              &lt;Link to=&quot;/orders&quot; className=&quot;text-orange-600 font-medium&quot;&gt;&#13;&#10;                My Orders&#13;&#10;              &lt;/Link&gt;&#13;&#10;            &lt;/nav&gt;&#13;&#10;&#13;&#10;            &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#13;&#10;              {user &amp;&amp; (&#13;&#10;                &lt;DropdownMenu&gt;&#13;&#10;                  &lt;DropdownMenuTrigger asChild&gt;&#13;&#10;                    &lt;Button variant=&quot;ghost&quot; className=&quot;relative h-9 w-9 rounded-full&quot;&gt;&#13;&#10;                      &lt;Avatar className=&quot;h-9 w-9&quot;&gt;&#13;&#10;                        &lt;AvatarImage src={user.avatar} alt={user.fullName || user.username} /&gt;&#13;&#10;                        &lt;AvatarFallback className=&quot;bg-orange-600 text-white&quot;&gt;&#13;&#10;                          {getUserInitials()}&#13;&#10;                        &lt;/AvatarFallback&gt;&#13;&#10;                      &lt;/Avatar&gt;&#13;&#10;                    &lt;/Button&gt;&#13;&#10;                  &lt;/DropdownMenuTrigger&gt;&#13;&#10;                  &lt;DropdownMenuContent className=&quot;w-56&quot; align=&quot;end&quot;&gt;&#13;&#10;                    &lt;DropdownMenuLabel&gt;&#13;&#10;                      &lt;div className=&quot;flex flex-col space-y-1&quot;&gt;&#13;&#10;                        &lt;p className=&quot;text-sm font-medium&quot;&gt;{user.fullName || user.username}&lt;/p&gt;&#13;&#10;                        &lt;p className=&quot;text-xs text-gray-500&quot;&gt;{user.email}&lt;/p&gt;&#13;&#10;                      &lt;/div&gt;&#13;&#10;                    &lt;/DropdownMenuLabel&gt;&#13;&#10;                    &lt;DropdownMenuSeparator /&gt;&#13;&#10;                    &lt;DropdownMenuItem onClick={() =&gt; navigate('/profile')}&gt;&#13;&#10;                      &lt;User className=&quot;mr-2 h-4 w-4&quot; /&gt;&#13;&#10;                      Profile&#13;&#10;                    &lt;/DropdownMenuItem&gt;&#13;&#10;                    &lt;DropdownMenuItem onClick={() =&gt; navigate('/orders')}&gt;&#13;&#10;                      &lt;Package className=&quot;mr-2 h-4 w-4&quot; /&gt;&#13;&#10;                      My Orders&#13;&#10;                    &lt;/DropdownMenuItem&gt;&#13;&#10;                    &lt;DropdownMenuItem onClick={() =&gt; navigate('/settings')}&gt;&#13;&#10;                      &lt;Settings className=&quot;mr-2 h-4 w-4&quot; /&gt;&#13;&#10;                      Settings&#13;&#10;                    &lt;/DropdownMenuItem&gt;&#13;&#10;                    &lt;DropdownMenuSeparator /&gt;&#13;&#10;                    &lt;DropdownMenuItem onClick={handleLogout} className=&quot;text-red-600&quot;&gt;&#13;&#10;                      &lt;LogOut className=&quot;mr-2 h-4 w-4&quot; /&gt;&#13;&#10;                      Logout&#13;&#10;                    &lt;/DropdownMenuItem&gt;&#13;&#10;                  &lt;/DropdownMenuContent&gt;&#13;&#10;                &lt;/DropdownMenu&gt;&#13;&#10;              )}&#13;&#10;            &lt;/div&gt;&#13;&#10;          &lt;/div&gt;&#13;&#10;        &lt;/div&gt;&#13;&#10;      &lt;/header&gt;&#13;&#10;&#13;&#10;      {/* Main Content */}&#13;&#10;      &lt;main className=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8&quot;&gt;&#13;&#10;        &lt;div className=&quot;mb-6 flex items-center justify-between&quot;&gt;&#13;&#10;          &lt;div&gt;&#13;&#10;            &lt;h1 className=&quot;text-3xl font-bold text-gray-900&quot;&gt;My Orders&lt;/h1&gt;&#13;&#10;            &lt;p className=&quot;text-gray-600 mt-1&quot;&gt;Track and manage your food orders&lt;/p&gt;&#13;&#10;          &lt;/div&gt;&#13;&#10;          &lt;Button&#13;&#10;            variant=&quot;outline&quot;&#13;&#10;            onClick={() =&gt; navigate('/products')}&#13;&#10;            className=&quot;flex items-center gap-2&quot;&#13;&#10;          &gt;&#13;&#10;            &lt;ArrowLeft className=&quot;w-4 h-4&quot; /&gt;&#13;&#10;            Continue Shopping&#13;&#10;          &lt;/Button&gt;&#13;&#10;        &lt;/div&gt;&#13;&#10;&#13;&#10;        {loading ? (&#13;&#10;          &lt;div className=&quot;text-center py-16&quot;&gt;&#13;&#10;            &lt;div className=&quot;inline-block animate-spin rounded-full h-12 w-12 border-4 border-gray-300 border-t-orange-600&quot;&gt;&lt;/div&gt;&#13;&#10;            &lt;p className=&quot;text-gray-600 text-lg mt-4&quot;&gt;Loading your orders...&lt;/p&gt;&#13;&#10;          &lt;/div&gt;&#13;&#10;        ) : error ? (&#13;&#10;          &lt;Card className=&quot;p-12 text-center&quot;&gt;&#13;&#10;            &lt;XCircle className=&quot;w-20 h-20 mx-auto text-red-400 mb-4&quot; /&gt;&#13;&#10;            &lt;h2 className=&quot;text-2xl font-bold text-gray-900 mb-2&quot;&gt;{error}&lt;/h2&gt;&#13;&#10;            &lt;Button&#13;&#10;              onClick={fetchOrders}&#13;&#10;              className=&quot;mt-4 bg-orange-600 hover:bg-orange-700&quot;&#13;&#10;            &gt;&#13;&#10;              Try Again&#13;&#10;            &lt;/Button&gt;&#13;&#10;          &lt;/Card&gt;&#13;&#10;        ) : orders.length === 0 ? (&#13;&#10;          &lt;Card className=&quot;p-12 text-center&quot;&gt;&#13;&#10;            &lt;ShoppingBag className=&quot;w-20 h-20 mx-auto text-gray-300 mb-4&quot; /&gt;&#13;&#10;            &lt;h2 className=&quot;text-2xl font-bold text-gray-900 mb-2&quot;&gt;No orders yet&lt;/h2&gt;&#13;&#10;            &lt;p className=&quot;text-gray-600 mb-6&quot;&gt;Start ordering delicious food!&lt;/p&gt;&#13;&#10;            &lt;Button&#13;&#10;              onClick={() =&gt; navigate('/products')}&#13;&#10;              className=&quot;bg-orange-600 hover:bg-orange-700&quot;&#13;&#10;            &gt;&#13;&#10;              Browse Menu&#13;&#10;            &lt;/Button&gt;&#13;&#10;          &lt;/Card&gt;&#13;&#10;        ) : (&#13;&#10;          &lt;div className=&quot;grid md:grid-cols-2 lg:grid-cols-3 gap-6&quot;&gt;&#13;&#10;            {orders.map((order) =&gt; (&#13;&#10;              &lt;OrderCard&#13;&#10;                key={order.id}&#13;&#10;                order={order}&#13;&#10;                onViewDetails={handleViewDetails}&#13;&#10;              /&gt;&#13;&#10;            ))}&#13;&#10;          &lt;/div&gt;&#13;&#10;        )}&#13;&#10;&#13;&#10;        {/* Order Details Dialog */}&#13;&#10;        {selectedOrder &amp;&amp; (&#13;&#10;          &lt;Dialog open={Boolean(selectedOrder)} onOpenChange={handleCloseDialog}&gt;&#13;&#10;            &lt;DialogContent className=&quot;max-w-2xl max-h-[90vh] overflow-y-auto p-6 mx-auto rounded-lg shadow-lg bg-white&quot;&gt;&#13;&#10;              &lt;DialogHeader&gt;&#13;&#10;                &lt;div className=&quot;flex items-center justify-between&quot;&gt;&#13;&#10;                  &lt;DialogTitle className=&quot;text-lg font-bold text-gray-900&quot;&gt;&#13;&#10;                    Order Details&#13;&#10;                  &lt;/DialogTitle&gt;&#13;&#10;                  &lt;Button&#13;&#10;                    variant=&quot;ghost&quot;&#13;&#10;                    onClick={handleCloseDialog}&#13;&#10;                    className=&quot;rounded-full p-2 hover:bg-gray-100&quot;&#13;&#10;                  &gt;&#13;&#10;                    &lt;X className=&quot;w-5 h-5 text-gray-500&quot; /&gt;&#13;&#10;                  &lt;/Button&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;              &lt;/DialogHeader&gt;&#13;&#10;              &lt;DialogDescription className=&quot;mt-4 text-sm text-gray-700&quot;&gt;&#13;&#10;                &lt;div className=&quot;space-y-4&quot;&gt;&#13;&#10;                  &lt;div&gt;&#13;&#10;                    &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#13;&#10;                      Order ID&#13;&#10;                    &lt;/span&gt;&#13;&#10;                    &lt;span className=&quot;block text-sm font-medium text-gray-900&quot;&gt;&#13;&#10;                      {selectedOrder.id}&#13;&#10;                    &lt;/span&gt;&#13;&#10;                  &lt;/div&gt;&#13;&#10;                  &lt;div&gt;&#13;&#10;                    &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#13;&#10;                      Order Date&#13;&#10;                    &lt;/span&gt;&#13;&#10;                    &lt;span className=&quot;block text-sm font-medium text-gray-900&quot;&gt;&#13;&#10;                      {new Date(selectedOrder.createdAt).toLocaleString()}&#13;&#10;                    &lt;/span&gt;&#13;&#10;                  &lt;/div&gt;&#13;&#10;                  &lt;div&gt;&#13;&#10;                    &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#13;&#10;                      Status&#13;&#10;                    &lt;/span&gt;&#13;&#10;                    &lt;Badge className={`${getStatusColor(selectedOrder.status)} inline-flex items-center gap-1`}&gt;&#13;&#10;                      {getStatusIcon(selectedOrder.status)}&#13;&#10;                      {statusText[selectedOrder.status]}&#13;&#10;                    &lt;/Badge&gt;&#13;&#10;                  &lt;/div&gt;&#13;&#10;&#13;&#10;                  {/* Thêm thông tin Payment */}&#13;&#10;                  {selectedOrder.paymentMethod &amp;&amp; (&#13;&#10;                    &lt;div&gt;&#13;&#10;                      &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#13;&#10;                        Payment Method&#13;&#10;                      &lt;/span&gt;&#13;&#10;                      &lt;span className=&quot;block text-sm font-medium text-gray-900 capitalize&quot;&gt;&#13;&#10;                        {selectedOrder.paymentMethod}&#13;&#10;                      &lt;/span&gt;&#13;&#10;                    &lt;/div&gt;&#13;&#10;                  )}&#13;&#10;&#13;&#10;                  {selectedOrder.paymentStatus &amp;&amp; (&#13;&#10;                    &lt;div&gt;&#13;&#10;                      &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#13;&#10;                        Payment Status&#13;&#10;                      &lt;/span&gt;&#13;&#10;                      &lt;Badge className={&#13;&#10;                        selectedOrder.paymentStatus === 'SUCCESS'&#13;&#10;                          ? 'bg-green-100 text-green-800'&#13;&#10;                          : selectedOrder.paymentStatus === 'FAILED'&#13;&#10;                          ? 'bg-red-100 text-red-800'&#13;&#10;                          : 'bg-yellow-100 text-yellow-800'&#13;&#10;                      }&gt;&#13;&#10;                        {selectedOrder.paymentStatus}&#13;&#10;                      &lt;/Badge&gt;&#13;&#10;                    &lt;/div&gt;&#13;&#10;                  )}&#13;&#10;&#13;&#10;                  {/* Thông tin Delivery &amp; Drone */}&#13;&#10;                  {['PREPARING', 'DELIVERING', 'DELIVERED'].includes(selectedOrder.status) &amp;&amp; (&#13;&#10;                    &lt;&gt;&#13;&#10;                      &lt;Separator className=&quot;my-4&quot; /&gt;&#13;&#10;                      &lt;div className=&quot;bg-blue-50 p-4 rounded-lg&quot;&gt;&#13;&#10;                        {loadingDelivery ? (&#13;&#10;                          &lt;div className=&quot;text-center py-4&quot;&gt;&#13;&#10;                            &lt;div className=&quot;inline-block animate-spin rounded-full h-8 w-8 border-4 border-gray-300 border-t-blue-600&quot;&gt;&lt;/div&gt;&#13;&#10;                            &lt;p className=&quot;text-gray-600 text-sm mt-2&quot;&gt;Đang tải thông tin giao hàng...&lt;/p&gt;&#13;&#10;                          &lt;/div&gt;&#13;&#10;                        ) : deliveryInfo ? (&#13;&#10;                          &lt;&gt;&#13;&#10;                            &lt;DeliveryInfo delivery={deliveryInfo} /&gt;&#13;&#10;&#13;&#10;                            {/* Track on Map Button */}&#10;                            {((deliveryInfo.currentLat &amp;&amp; deliveryInfo.currentLng) || &#10;                              (deliveryInfo.current_lat &amp;&amp; deliveryInfo.current_lng)) &amp;&amp; (&#10;                              &lt;button&#10;                                onClick={() =&gt; setShowMap(true)}&#10;                                className=&quot;mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors&quot;&#10;                              &gt;&#10;                                &lt;Map className=&quot;w-5 h-5&quot; /&gt;&#10;                                Theo dõi trên bản đồ&#10;                              &lt;/button&gt;&#10;                            )}&#13;&#10;                          &lt;/&gt;&#13;&#10;                        ) : (&#13;&#10;                          &lt;p className=&quot;text-sm text-gray-600 text-center&quot;&gt;&#13;&#10;                            Thông tin giao hàng sẽ có sau khi nhà hàng chuẩn bị xong đơn hàng của bạn.&#13;&#10;                          &lt;/p&gt;&#13;&#10;                        )}&#13;&#10;                      &lt;/div&gt;&#13;&#10;                    &lt;/&gt;&#13;&#10;                  )}&#13;&#10;                &lt;/div&gt;&#13;&#10;&#13;&#10;                &lt;Separator className=&quot;my-4&quot; /&gt;&#13;&#10;&#13;&#10;                &lt;div&gt;&#13;&#10;                  &lt;span className=&quot;block text-xs font-semibold text-gray-500&quot;&gt;&#13;&#10;                    Items&#13;&#10;                  &lt;/span&gt;&#13;&#10;                  &lt;div className=&quot;space-y-2&quot;&gt;&#13;&#10;                    {selectedOrder.orderItems?.map((item, index) =&gt; (&#13;&#10;                      &lt;div key={index} className=&quot;flex justify-between text-sm&quot;&gt;&#13;&#10;                        &lt;span className=&quot;text-gray-600&quot;&gt;&#13;&#10;                          {item.quantity}x {item.productName || `Product #${item.productId}`}&#13;&#10;                        &lt;/span&gt;&#13;&#10;                        &lt;span className=&quot;font-medium&quot;&gt;${(item.price * item.quantity).toFixed(2)}&lt;/span&gt;&#13;&#10;                      &lt;/div&gt;&#13;&#10;                    ))}&#13;&#10;                  &lt;/div&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;&#13;&#10;                &lt;Separator className=&quot;my-4&quot; /&gt;&#13;&#10;&#13;&#10;                &lt;div className=&quot;flex justify-between items-center&quot;&gt;&#13;&#10;                  &lt;span className=&quot;text-lg font-bold text-orange-600&quot;&gt;&#13;&#10;                    Total: ${selectedOrder.totalPrice?.toFixed(2) || '0.00'}&#13;&#10;                  &lt;/span&gt;&#13;&#10;                &lt;/div&gt;&#13;&#10;              &lt;/DialogDescription&gt;&#13;&#10;            &lt;/DialogContent&gt;&#13;&#10;          &lt;/Dialog&gt;&#13;&#10;        )}&#13;&#10;&#13;&#10;        {/* Drone Map Modal */}&#13;&#10;        {showMap &amp;&amp; deliveryInfo &amp;&amp; (&#13;&#10;          &lt;div className=&quot;fixed inset-0 bg-black bg-opacity-75 z-[9999] flex items-center justify-center p-4&quot;&gt;&#13;&#10;            &lt;div className=&quot;bg-white rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden&quot;&gt;&#13;&#10;              &lt;DroneMap&#13;&#10;                delivery={deliveryInfo}&#13;&#10;                onClose={() =&gt; setShowMap(false)}&#13;&#10;              /&gt;&#13;&#10;            &lt;/div&gt;&#13;&#10;          &lt;/div&gt;&#13;&#10;        )}&#13;&#10;      &lt;/main&gt;&#13;&#10;    &lt;/div&gt;&#13;&#10;  );&#13;&#10;}&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Front_end/foodfast-app/src/services/deliveryService.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Front_end/foodfast-app/src/services/deliveryService.js" />
              <option name="originalContent" value="import axios from 'axios';&#10;import config from '../config/apiConfig';&#10;&#10;// Create axios instance for delivery service&#10;const deliveryApi = axios.create({&#10;  baseURL: config.getDeliveryServiceUrl(),&#10;  headers: {&#10;    'Content-Type': 'application/json',&#10;  },&#10;});&#10;&#10;// Add token to requests&#10;deliveryApi.interceptors.request.use(&#10;  (config) =&gt; {&#10;    const token = localStorage.getItem('token');&#10;    if (token) {&#10;      config.headers.Authorization = `Bearer ${token}`;&#10;    }&#10;    return config;&#10;  },&#10;  (error) =&gt; {&#10;    return Promise.reject(error);&#10;  }&#10;);&#10;&#10;const deliveryService = {&#10;  // Lấy delivery info theo orderId&#10;  getDeliveryByOrderId: async (orderId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get(`/deliveries/order/${orderId}`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching delivery:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Lấy tất cả deliveries đang hoạt động&#10;  getActiveDeliveries: async () =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get('/deliveries/active');&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching active deliveries:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Lấy tất cả deliveries&#10;  getAllDeliveries: async () =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get('/deliveries');&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching all deliveries:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Lấy deliveries theo droneId&#10;  getDeliveriesByDrone: async (droneId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get(`/deliveries/drone/${droneId}`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching deliveries by drone:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Cập nhật vị trí drone (for tracking)&#10;  updateDroneLocation: async (deliveryId, lat, lng) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.put(`/deliveries/${deliveryId}/location`, null, {&#10;        params: { lat, lng }&#10;      });&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error updating drone location:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Thủ công đánh dấu drone đã lấy hàng (for testing)&#10;  markPickedUp: async (deliveryId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.post(`/deliveries/${deliveryId}/pickup`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error marking picked up:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Thủ công bắt đầu giao hàng (for testing)&#10;  startDelivery: async (deliveryId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.post(`/deliveries/${deliveryId}/start`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error starting delivery:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Thủ công hoàn thành giao hàng (for testing)&#10;  completeDelivery: async (deliveryId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.post(`/deliveries/${deliveryId}/complete`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error completing delivery:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Helper function để format delivery status&#10;  formatDeliveryStatus: (status) =&gt; {&#10;    const statusMap = {&#10;      PENDING: 'Đang chờ',&#10;      ASSIGNED: 'Đã phân công drone',&#10;      PICKING_UP: 'Drone đang đến nhà hàng',&#10;      PICKED_UP: 'Đã lấy hàng',&#10;      DELIVERING: 'Đang giao hàng',&#10;      COMPLETED: 'Hoàn thành',&#10;      CANCELLED: 'Đã hủy'&#10;    };&#10;    return statusMap[status] || status;&#10;  },&#10;&#10;  // Helper function để get delivery status color&#10;  getDeliveryStatusColor: (status) =&gt; {&#10;    const colorMap = {&#10;      PENDING: 'bg-gray-100 text-gray-800',&#10;      ASSIGNED: 'bg-blue-100 text-blue-800',&#10;      PICKING_UP: 'bg-yellow-100 text-yellow-800',&#10;      PICKED_UP: 'bg-purple-100 text-purple-800',&#10;      DELIVERING: 'bg-indigo-100 text-indigo-800',&#10;      COMPLETED: 'bg-green-100 text-green-800',&#10;      CANCELLED: 'bg-red-100 text-red-800'&#10;    };&#10;    return colorMap[status] || 'bg-gray-100 text-gray-800';&#10;  }&#10;};&#10;&#10;export default deliveryService;&#10;" />
              <option name="updatedContent" value="import axios from 'axios';&#10;import config from '../config/apiConfig';&#10;&#10;// Create axios instance for delivery service&#10;const deliveryApi = axios.create({&#10;  baseURL: config.getDeliveryServiceUrl(),&#10;  headers: {&#10;    'Content-Type': 'application/json',&#10;  },&#10;});&#10;&#10;// Add token to requests&#10;deliveryApi.interceptors.request.use(&#10;  (config) =&gt; {&#10;    const token = localStorage.getItem('token');&#10;    if (token) {&#10;      config.headers.Authorization = `Bearer ${token}`;&#10;    }&#10;    return config;&#10;  },&#10;  (error) =&gt; {&#10;    return Promise.reject(error);&#10;  }&#10;);&#10;&#10;const deliveryService = {&#10;  // Lấy delivery info theo orderId&#10;  getDeliveryByOrderId: async (orderId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get(`/deliveries/order/${orderId}`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching delivery:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Lấy delivery info theo deliveryId&#10;  getDeliveryById: async (deliveryId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get(`/deliveries/${deliveryId}`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching delivery by ID:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Lấy tất cả deliveries đang hoạt động&#10;  getActiveDeliveries: async () =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get('/deliveries/active');&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching active deliveries:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Lấy tất cả deliveries&#10;  getAllDeliveries: async () =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get('/deliveries');&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching all deliveries:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Lấy deliveries theo droneId&#10;  getDeliveriesByDrone: async (droneId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.get(`/deliveries/drone/${droneId}`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error fetching deliveries by drone:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Cập nhật vị trí drone (for tracking)&#10;  updateDroneLocation: async (deliveryId, lat, lng) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.put(`/deliveries/${deliveryId}/location`, null, {&#10;        params: { lat, lng }&#10;      });&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error updating drone location:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Thủ công đánh dấu drone đã lấy hàng (for testing)&#10;  markPickedUp: async (deliveryId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.post(`/deliveries/${deliveryId}/pickup`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error marking picked up:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Thủ công bắt đầu giao hàng (for testing)&#10;  startDelivery: async (deliveryId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.post(`/deliveries/${deliveryId}/start`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error starting delivery:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Thủ công hoàn thành giao hàng (for testing)&#10;  completeDelivery: async (deliveryId) =&gt; {&#10;    try {&#10;      const response = await deliveryApi.post(`/deliveries/${deliveryId}/complete`);&#10;      return response.data;&#10;    } catch (error) {&#10;      console.error('Error completing delivery:', error);&#10;      throw error;&#10;    }&#10;  },&#10;&#10;  // Helper function để format delivery status&#10;  formatDeliveryStatus: (status) =&gt; {&#10;    const statusMap = {&#10;      PENDING: 'Đang chờ',&#10;      ASSIGNED: 'Đã phân công drone',&#10;      PICKING_UP: 'Drone đang đến nhà hàng',&#10;      PICKED_UP: 'Đã lấy hàng',&#10;      DELIVERING: 'Đang giao hàng',&#10;      COMPLETED: 'Hoàn thành',&#10;      CANCELLED: 'Đã hủy'&#10;    };&#10;    return statusMap[status] || status;&#10;  },&#10;&#10;  // Helper function để get delivery status color&#10;  getDeliveryStatusColor: (status) =&gt; {&#10;    const colorMap = {&#10;      PENDING: 'bg-gray-100 text-gray-800',&#10;      ASSIGNED: 'bg-blue-100 text-blue-800',&#10;      PICKING_UP: 'bg-yellow-100 text-yellow-800',&#10;      PICKED_UP: 'bg-purple-100 text-purple-800',&#10;      DELIVERING: 'bg-indigo-100 text-indigo-800',&#10;      COMPLETED: 'bg-green-100 text-green-800',&#10;      CANCELLED: 'bg-red-100 text-red-800'&#10;    };&#10;    return colorMap[status] || 'bg-gray-100 text-gray-800';&#10;  }&#10;};&#10;&#10;export default deliveryService;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/test-api.html">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/test-api.html" />
              <option name="updatedContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;Test Product API&lt;/title&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;h1&gt;Test Product API&lt;/h1&gt;&#10;    &lt;button onclick=&quot;testProducts()&quot;&gt;Test Get All Products&lt;/button&gt;&#10;    &lt;button onclick=&quot;testCategories()&quot;&gt;Test Get All Categories&lt;/button&gt;&#10;    &lt;button onclick=&quot;testRestaurants()&quot;&gt;Test Get All Restaurants&lt;/button&gt;&#10;    &lt;div id=&quot;result&quot;&gt;&lt;/div&gt;&#10;&#10;    &lt;script&gt;&#10;        async function testProducts() {&#10;            const resultDiv = document.getElementById('result');&#10;            resultDiv.innerHTML = '&lt;p&gt;Loading products...&lt;/p&gt;';&#10;            &#10;            try {&#10;                const response = await fetch('http://localhost:8080/api/products');&#10;                const data = await response.json();&#10;                resultDiv.innerHTML = '&lt;h2&gt;Products Response:&lt;/h2&gt;&lt;pre&gt;' + JSON.stringify(data, null, 2) + '&lt;/pre&gt;';&#10;                console.log('Products:', data);&#10;            } catch (error) {&#10;                resultDiv.innerHTML = '&lt;h2 style=&quot;color: red;&quot;&gt;Error:&lt;/h2&gt;&lt;p&gt;' + error.message + '&lt;/p&gt;';&#10;                console.error('Error:', error);&#10;            }&#10;        }&#10;&#10;        async function testCategories() {&#10;            const resultDiv = document.getElementById('result');&#10;            resultDiv.innerHTML = '&lt;p&gt;Loading categories...&lt;/p&gt;';&#10;            &#10;            try {&#10;                const response = await fetch('http://localhost:8080/api/categories');&#10;                const data = await response.json();&#10;                resultDiv.innerHTML = '&lt;h2&gt;Categories Response:&lt;/h2&gt;&lt;pre&gt;' + JSON.stringify(data, null, 2) + '&lt;/pre&gt;';&#10;                console.log('Categories:', data);&#10;            } catch (error) {&#10;                resultDiv.innerHTML = '&lt;h2 style=&quot;color: red;&quot;&gt;Error:&lt;/h2&gt;&lt;p&gt;' + error.message + '&lt;/p&gt;';&#10;                console.error('Error:', error);&#10;            }&#10;        }&#10;&#10;        async function testRestaurants() {&#10;            const resultDiv = document.getElementById('result');&#10;            resultDiv.innerHTML = '&lt;p&gt;Loading restaurants...&lt;/p&gt;';&#10;            &#10;            try {&#10;                const response = await fetch('http://localhost:8080/api/restaurants');&#10;                const data = await response.json();&#10;                resultDiv.innerHTML = '&lt;h2&gt;Restaurants Response:&lt;/h2&gt;&lt;pre&gt;' + JSON.stringify(data, null, 2) + '&lt;/pre&gt;';&#10;                console.log('Restaurants:', data);&#10;            } catch (error) {&#10;                resultDiv.innerHTML = '&lt;h2 style=&quot;color: red;&quot;&gt;Error:&lt;/h2&gt;&lt;p&gt;' + error.message + '&lt;/p&gt;';&#10;                console.error('Error:', error);&#10;            }&#10;        }&#10;    &lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>